"use strict";angular.module("postoffice.tkbd").controller("TKBDHistoryController",["$scope","apiService","notificationService","$ngBootbox","$filter","$state","authService","$stateParams",function(n,t,i,r,u,f,e,o){function a(){n.tkbd.districtId=0;n.tkbd.poId=0;n.tkbd.userId="";n.show=!1}function h(){t.get("/api/district/getallparents",null,function(t){n.tkbd.districts=t.data},function(){i.displayError("Không tải được danh sách huyện.")})}function s(){t.get("/api/po/getbydistrictid/ "+o.id,null,function(t){n.tkbd.pos=t.data},function(){i.displayError("Không tải được danh sách đơn vị.")})}function c(){t.get("/api/applicationUser/getuserbypoid/"+o.id,null,function(t){n.tkbd.users=t.data},function(){i.displayError("Không tải được danh sách nhân viên.")})}function v(){l()}function l(r){r=r||0;var u=n.tkbd.date.startDate.format("MM-DD-YYYY"),f=n.tkbd.date.endDate.format("MM-DD-YYYY"),e={params:{fromDate:u,toDate:f,districtId:n.tkbd.districtId||0,poId:n.tkbd.poId||0,userId:n.tkbd.userId||"",page:r,pageSize:40}};n.tkbds=[];t.get("api/tkbd/gethistorybycondition",e,function(t){t.data.TotalCount===0?(i.displayWarning("Không tìm thấy bản ghi nào!"),n.loading=!1):(n.tkbds=t.data.Items,n.page=t.data.Page,n.pagesCount=t.data.TotalPages,n.totalCount=t.data.TotalCount,n.show=!0,n.loading=!1)},function(){n.loading=!1;console.log("Load list TKBD History failed")})}n.page=0;n.pagesCount=0;n.tkbds=[];n.show=!1;n.keyword="";n.search=v;n.loading=!0;n.tkbd={functionId:0,date:{startDate:moment(),endDate:moment()},districts:[],pos:[],users:[],districtId:0,poId:0,userId:"",serviceId:0};n.Reset=a;o.id=0;n.isManager=e.haveRole("Manager");n.isAdmin=e.haveRole("Administrator");n.isManager?(o.id=e.authentication.userName,t.get("/api/applicationUser/userinfo",null,function(t){o.id=t.data.POID;n.tkbd.districtId=t.data.POID;s()},function(){i.displayError("Không tải được danh sách huyện/ thành phố.")})):n.isAdmin&&h();n.getDistricts=h;n.updatePos=function(t){t!==0&&t!==null?(o.id=t,s()):(n.tkbd.pos=[],n.tkbd.poId=0)};n.getPos=s;n.updateUser=function(t){t!==0&&t!==null?(o.id=t,c()):(n.tkbd.users=[],n.tkbd.userId=0)};n.getListUser=c;n.getTkbdHistory=l;n.getTKBD1Day=function(r){r=r||0;var u={params:{page:r,pageSize:20}};t.get("/api/tkbd/gettkbd1day",u,function(t){t.data.TotalCount===0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})};n.getTKBD7Day=function(r){r=r||0;var u={params:{page:r,pageSize:20}};t.get("/api/tkbd/gettkbd7day",u,function(t){t.data.TotalCount===0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})};n.getTKBD30Day=function(r){r=r||0;var u={params:{page:r,pageSize:20}};t.get("/api/tkbd/gettkbd30day",u,function(t){t.data.TotalCount===0&&i.displayWarning("Không tìm thấy bản ghi nào!");n.tkbds=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;n.loading=!1},function(){n.loading=!1;console.log("Load list TKBD History failed")})}}]);