"use strict";angular.module("postoffice.tkbd").controller("tkbdListController",["$scope","apiService","notificationService","$ngBootbox","$filter","$state","$stateParams","authService",function(n,t,i,r,u,f,e,o){function h(){t.get("/api/district/getallparents",null,function(t){n.tkbd.districts=t.data},function(){i.displayError("Không tải được danh sách huyện.")})}function s(){t.get("/api/po/getbydistrictid/ "+e.id,null,function(t){n.tkbd.pos=t.data},function(){i.displayError("Không tải được danh sách đơn vị.")})}function c(){t.get("/api/applicationUser/getuserbypoid/"+e.id,null,function(t){n.tkbd.users=t.data},function(){i.displayError("Không tải được danh sách nhân viên.")})}function l(){getTkbds()}function a(){t.get("/api/tkbd/update",null,function(t){console.log(t.data.TotalCount);n.loading=!1;n.tkbd=t.data.Items;n.page=t.data.Page;n.pagesCount=t.data.TotalPages;n.totalCount=t.data.TotalCount;f.reload()},function(){n.loading=!1;console.log("Load tkbds failed")})}function v(){var u=n.tkbd.dates.getMonth()+1,f=n.tkbd.dates.getFullYear(),r;console.log(n.tkbd.dates);r={params:{month:u,year:f,districtId:n.tkbd.districtId||0,functionId:n.tkbd.functionId||0,poId:n.tkbd.poId||0,userId:n.tkbd.userId||"",serviceId:n.tkbd.serviceId||0}};t.get("/api/tkbd/export",r,function(t){n.loading=!0;t.status===200&&(window.location.href=t.data.Message,n.loading=!1)},function(t){t.status===500?(i.displayError("Không có dữ liệu"),n.loading=!1):(i.displayError("Không thể tải dữ liệu"),n.loading=!1)})}n.page=0;n.pagesCount=0;n.tkbds=[];n.keyword="";n.search=l;n.loading=!0;n.update=a;n.tkbd={functionId:null,date:{startDate:null,endDate:null},districts:[],pos:[],users:[],districtId:0,posId:0,userId:"",serviceId:0};n.tkbd.dates=null;e.id=0;n.functions=[{Id:1,Name:"Thống kê tổng hợp giao dịch phát sinh"},{Id:2,Name:"Thống kê chi tiết giao dịch phát sinh"}];n.isManager=o.haveRole("Manager");n.isAdmin=o.haveRole("Administrator");n.isManager?(e.id=o.authentication.userName,t.get("/api/applicationUser/userinfo",null,function(t){e.id=t.data.POID;n.tkbd.districtId=t.data.POID;s()},function(){i.displayError("Không tải được danh sách huyện/ thành phố.")})):n.isAdmin&&h();n.getDistricts=h;n.updatePos=function(t){t!==0&&t!==null?(e.id=t,s()):(n.tkbd.pos=[],n.tkbd.posId=0)};n.getPos=s;n.updateUser=function(t){t!==0&&t!==null?(e.id=t,c()):(n.tkbd.users=[],n.tkbd.userId=0)};n.getListUser=c;n.Export=v}]);