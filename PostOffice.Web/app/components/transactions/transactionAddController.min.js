(function(n){function t(n,t,i,r,u,f,e,o){function l(){n.transaction.ServiceId=n.transaction.Service.ID;n.transaction.TransactionDate=$("#datetimepicker1").find("input").val();(new Date).getTime()-new Date(n.transaction.TransactionDate).getTime()>1728e5?i.displayError("Ngày giao dịch đã chậm quá 2 ngày"):(n.transaction.TransactionDetails=[],n.transaction.Properties.forEach(function(t){n.transaction.TransactionDetails.push({Money:t.Money,PropertyServiceId:t.ID,Status:!0,TransactionId:-1})}),t.post("/api/transactions/create",n.transaction,function(){i.displaySuccess("Giao dịch thành công");o(function(){e.confirm("Bạn có muốn tiếp tục nhập?").then(function(){n.transaction.TransactionDetails=[];r.go(r.current,{},{reload:!0})},function(){r.go("transactions",{},{reload:!0})})},500)},function(){i.displayError("Giao dịch thất bại")}))}function s(){t.get("/api/property_services/getbyserviceid/"+f.id,null,function(t){n.transaction.Properties=t.data},function(n){i.displayError(n.data)})}function h(){t.get("/api/service/getbyid/"+f.id,null,function(t){n.transaction.Service=t.data;n.transaction.Service.Name=t.data.ID},function(n){i.displayError(n.data)})}function c(){t.get("/api/po/getbycurrentuser",null,function(r){t.get("/api/applicationUser/getuserbypoid/"+r.data.ID,null,function(t){n.transaction.Users=t.data},function(){i.displayError("Không tải được danh sách nhân viên.")})},function(){i.displayError("Không tải được thông tin nhân viên.")})}n.transaction={Status:!0,IsCash:!0,Users:null,Service:null,TransactionDate:null,UserId:null,Properties:[],TransactionDetails:[],Services:[]};n.getListUser=c;n.AddTransaction=l;n.onSelectCallback=function(n){f.id=n.ID;h();s()};onSelectStaffCallback=function(){f.id=item.Id};var v=new Date;h();s();c()}n.controller("transactionAddController",t);t.$inject=["$scope","apiService","notificationService","$state","commonService","$stateParams","$ngBootbox","$timeout"]})(angular.module("postoffice.transactions"));